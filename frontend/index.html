<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø¨Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§ÛŒØªØ§ - Ù†Ø³Ø®Ù‡ ØªØ­Øª ÙˆØ¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
            background-color: #f8f9fa;
            direction: rtl;
        }
        
        .header {
            background: linear-gradient(135deg, #4a6fa5, #2c5282);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .logo {
            width: 50px;
            height: 50px;
            margin-left: 15px;
        }
        
        .nav-tabs .nav-link {
            color: #495057;
            border: none;
            margin: 0 2px;
        }
        
        .nav-tabs .nav-link.active {
            background-color: #4a6fa5;
            color: white;
            border: none;
        }
        
        .tab-content {
            padding: 20px;
            background: white;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        
        .card {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            font-weight: bold;
            color: #4a6fa5;
        }
        
        .btn-primary {
            background-color: #4a6fa5;
            border-color: #4a6fa5;
        }
        
        .btn-primary:hover {
            background-color: #3a5f95;
            border-color: #3a5f95;
        }
        
        .progress {
            height: 25px;
            margin: 15px 0;
        }
        
        .progress-bar {
            background-color: #4a6fa5;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin: 2px;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .log-container {
            height: 300px;
            overflow-y: auto;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .log-success {
            color: #28a745;
        }
        
        .log-error {
            color: #dc3545;
        }
        
        .log-info {
            color: #17a2b8;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .form-control, .form-select {
            text-align: right;
        }
        
        /* Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ± Ø±ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                margin-bottom: 15px;
            }
        }
    </style>
    <!-- ÙÙˆÙ†Øª ÙˆØ²ÛŒØ± -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
</head>
<body>
    <!-- Ù‡Ø¯Ø± -->
    <div class="header">
        <div class="container">
            <div class="d-flex align-items-center">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTI1IDQ1QzM1LjgyMjggNDUgNDUgMzUuODIyOCA0NSAyNUM0NSAxNC4xNzcyIDM1LjgyMjggNSAyNSA1QzE0LjE3NzIgNSA1IDE0LjE3NzIgNSAyNUM1IDM1LjgyMjggMTQuMTc3MiA0NSAyNSA0NVoiIGZpbGw9IiNmZmYiLz4KPHBhdGggZD0iTTMyIDIwSDM0VjMwSDMyVjIwWiIgZmlsbD0iIzRhNmZhNSIvPgo8cGF0aCBkPSJNMTYgMjBIMThWMzBIMTZWMjBaIiBmaWxsPSIjNGE2ZmE1Ii8+CjxwYXRoIGQ9Ik0zNiAyOUgzNFYzMUgzNlYyOVoiIGZpbGw9IiM0YTZmYTUiLz4KPHBhdGggZD0iTTE0IDI5SDE2VjMxSDE0VjI5WiIgZmlsbD0iIzRhNmZhNSIvPgo8cGF0aCBkPSJNMzAgMTVIMzJWMjVIMzBWMTVaIiBmaWxsPSIjNGE2ZmE1Ii8+CjxwYXRoIGQ9Ik0xOCAxNUgyMFYyNUgxOFYxNVoiIGZpbGw9IiM0YTZmYTUiLz4KPC9zdmc+" alt="Ø±Ø¨Ø§Øª Ø§ÛŒØªØ§" class="logo">
                <div class="me-3">
                    <h3 class="mb-0">ğŸ¤– Ø±Ø¨Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§ÛŒØªØ§</h3>
                    <p class="mb-0" style="opacity: 0.9;">Ù†Ø³Ø®Ù‡ ØªØ­Øª ÙˆØ¨ - Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù†ØµØ¨</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¨â€ŒÙ‡Ø§ -->
    <div class="container mt-4">
        <ul class="nav nav-tabs" id="mainTabs">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#dashboard">
                    <i class="fas fa-home me-2"></i>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#login">
                    <i class="fas fa-sign-in-alt me-2"></i>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§ÛŒØªØ§
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#send">
                    <i class="fas fa-paper-plane me-2"></i>Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#settings">
                    <i class="fas fa-cog me-2"></i>ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#reports">
                    <i class="fas fa-chart-bar me-2"></i>Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
                </a>
            </li>
        </ul>

        <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§ -->
        <div class="tab-content" id="mainTabsContent">
            <!-- ØªØ¨ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
            <div class="tab-pane fade show active" id="dashboard">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <i class="fas fa-paper-plane fa-3x text-primary"></i>
                                </div>
                                <h3 class="text-center" id="totalMessages">0</h3>
                                <p class="text-center text-muted">Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">Ù…ÙˆÙÙ‚</div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <i class="fas fa-check-circle fa-3x text-success"></i>
                                </div>
                                <h3 class="text-center" id="successMessages">0</h3>
                                <p class="text-center text-muted">Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">Ø®Ø·Ø§</div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <i class="fas fa-times-circle fa-3x text-danger"></i>
                                </div>
                                <h3 class="text-center" id="errorMessages">0</h3>
                                <p class="text-center text-muted">Ù¾ÛŒØ§Ù… Ù†Ø§Ù…ÙˆÙÙ‚</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">ÙˆØ¶Ø¹ÛŒØª</div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <i class="fas fa-robot fa-3x text-info"></i>
                                </div>
                                <span class="status-badge status-success" id="botStatus">Ø¢Ù…Ø§Ø¯Ù‡</span>
                                <p class="text-center text-muted mt-2">ÙˆØ¶Ø¹ÛŒØª Ø±Ø¨Ø§Øª</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <i class="fas fa-bolt me-2"></i>Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <button class="btn btn-primary w-100" onclick="showTab('login')">
                                    <i class="fas fa-sign-in-alt me-2"></i>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§ÛŒØªØ§
                                </button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button class="btn btn-success w-100" onclick="showTab('send')">
                                    <i class="fas fa-play me-2"></i>Ø´Ø±ÙˆØ¹ Ø§Ø±Ø³Ø§Ù„ Ø¬Ø¯ÛŒØ¯
                                </button>
                            </div>
                            <div class="col-md-4 mb-3">
                                <button class="btn btn-info w-100" onclick="refreshStats()">
                                    <i class="fas fa-sync-alt me-2"></i>Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØªØ¨ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§ÛŒØªØ§ -->
            <div class="tab-pane fade" id="login">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø§ÛŒØªØ§</div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§ØªØŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø§ÛŒØªØ§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯
                                </div>
                                
                                <div class="mb-3">
                                    <label for="phoneNumber" class="form-label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø§ÛŒØªØ§</label>
                                    <input type="text" class="form-control" id="phoneNumber" 
                                           placeholder="Ù…Ø«Ø§Ù„: 09123456789" dir="ltr">
                                    <div class="form-text">Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ 09 Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯ Ùˆ 11 Ø±Ù‚Ù…ÛŒ Ø¨Ø§Ø´Ø¯</div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="alert alert-warning">
                                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù„Ø§Ú¯ÛŒÙ†:</h6>
                                        <ol>
                                            <li>Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
                                            <li>Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø´Ø±ÙˆØ¹ Ù„Ø§Ú¯ÛŒÙ†" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</li>
                                            <li>Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ÛŒ Ú©Ù‡ Ø¨Ù‡ Ø§ÛŒØªØ§ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ú©Ø§Ø¯Ø± Ù…Ø±Ø¨ÙˆØ·Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
                                            <li>Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø«Ø¨Øª Ú©Ø¯" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ ÙØ±Ø¢ÛŒÙ†Ø¯ ÙˆØ±ÙˆØ¯ ØªÚ©Ù…ÛŒÙ„ Ø´ÙˆØ¯.</li>
                                        </ol>
                                    </div>
                                </div>
                                
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary" onclick="startLogin()" id="loginBtn">
                                        <i class="fas fa-sign-in-alt me-2"></i>Ø´Ø±ÙˆØ¹ Ù„Ø§Ú¯ÛŒÙ†
                                    </button>
                                </div>

                                <div id="codeEntrySection" class="mt-4" style="display: none;">
                                    <hr>
                                    <h5>Ù…Ø±Ø­Ù„Ù‡ Û²: ÙˆØ±ÙˆØ¯ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯</h5>
                                    <p>Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø§ÛŒØªØ§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
                                    <div class="input-group">
                                        <input type="text" id="verificationCode" class="form-control" placeholder="Ú©Ø¯ ØªØ§ÛŒÛŒØ¯">
                                        <button id="submitCodeBtn" class="btn btn-success" onclick="submitCode()">
                                            <i class="fas fa-check"></i> Ø«Ø¨Øª Ú©Ø¯
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="loginStatus" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">ÙˆØ¶Ø¹ÛŒØª Ù†Ø´Ø³Øª</div>
                            <div class="card-body">
                                <div id="sessionStatus" class="text-center p-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</span>
                                    </div>
                                    <p class="mt-2">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù†Ø´Ø³Øª...</p>
                                </div>
                                
                                <div class="alert alert-secondary">
                                    <h6><i class="fas fa-shield-alt me-2"></i>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ:</h6>
                                    <ul class="mb-0">
                                        <li>Ù†Ø´Ø³Øª Ø´Ù…Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø§Ù…Ù† Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
                                        <li>ØªÙ†Ù‡Ø§ Ø¯Ø± Ù‡Ù…ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª</li>
                                        <li>Ù¾Ø³ Ø§Ø² ÛŒÚ© Ù…Ø§Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØªØ¨ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… -->
            <div class="tab-pane fade" id="send">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø±Ø³Ø§Ù„</div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="sendType" class="form-label">Ù†ÙˆØ¹ Ø§Ø±Ø³Ø§Ù„</label>
                                    <select class="form-select" id="sendType" onchange="updateSendType()">
                                        <option value="excel">Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù…Ø®Ø§Ø·Ø¨Ø§Ù† ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„</option>
                                        <option value="group_message">Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¢ÛŒØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ù¾ÛŒØ§Ù… Ú¯Ø±ÙˆÙ‡</option>
                                    </select>
                                </div>
                                
                                <div id="excelSection" class="mb-3">
                                    <label class="form-label">ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„</label>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="excelFile" 
                                               accept=".xlsx,.xls,.csv" style="display: none;">
                                        <button class="btn btn-outline-secondary" type="button" 
                                                onclick="document.getElementById('excelFile').click()">
                                            <i class="fas fa-file-excel me-2"></i>Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„
                                        </button>
                                    </div>
                                    <div class="form-text">ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø­Ø§ÙˆÛŒ Ø³ØªÙˆÙ†ÛŒ Ø§Ø² @username Ø¨Ø§Ø´Ø¯</div>
                                    <div id="excelFileName" class="mt-2 text-muted small"></div>
                                </div>
                                
                                <div id="groupSection" class="mb-3" style="display: none;">
                                    <div class="mb-3">
                                        <label for="groupName" class="form-label">Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡</label>
                                        <input type="text" class="form-control" id="groupName" 
                                               placeholder="Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ Ø¯Ø± Ø§ÛŒØªØ§">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="messagePrefix" class="form-label">Ù¾ÛŒØ´ÙˆÙ†Ø¯ Ù¾ÛŒØ§Ù… Ù‡Ø¯Ù</label>
                                        <input type="text" class="form-control" id="messagePrefix" 
                                               placeholder="Ù…Ø«Ø§Ù„: Ù…Ø§Ú˜ÛŒÚ©_Ø³Ø§Ø¹Øª">
                                        <div class="form-text">Ø±Ø¨Ø§Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙˆÛŒ Ø§ÛŒÙ† Ù¾ÛŒØ´ÙˆÙ†Ø¯ Ø±Ø§ Ø¯Ø± Ú¯Ø±ÙˆÙ‡ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯</div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="messageToSend" class="form-label">Ù…ØªÙ† Ù¾ÛŒØ§Ù…</label>
                                    <textarea class="form-control" id="messageToSend" rows="3" 
                                              placeholder="Ù…ØªÙ† Ù¾ÛŒØ§Ù…ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯..."></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">ÙØ§ØµÙ„Ù‡ Ø§Ø±Ø³Ø§Ù„ (Ø«Ø§Ù†ÛŒÙ‡)</label>
                                    <div class="row">
                                        <div class="col">
                                            <input type="number" class="form-control" id="minDelay" 
                                                   min="1" max="60" step="0.5" value="2.0" placeholder="Ø­Ø¯Ø§Ù‚Ù„">
                                        </div>
                                        <div class="col-auto align-self-center">ØªØ§</div>
                                        <div class="col">
                                            <input type="number" class="form-control" id="maxDelay" 
                                                   min="2" max="120" step="0.5" value="5.0" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø±">
                                        </div>
                                    </div>
                                    <div class="form-text">Ø±Ø¨Ø§Øª Ø¨Ù‡ ØµÙˆØ±Øª Ø±Ù†Ø¯ÙˆÙ… Ø¨ÛŒÙ† Ø§ÛŒÙ† Ø¯Ùˆ Ù…Ù‚Ø¯Ø§Ø± ØªØ£Ø®ÛŒØ± Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯</div>
                                </div>
                                
                                <button class="btn btn-success w-100" onclick="startSending()" id="sendBtn">
                                    <i class="fas fa-play me-2"></i>Ø´Ø±ÙˆØ¹ Ø§Ø±Ø³Ø§Ù„
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="card mb-3">
                            <div class="card-header">Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ø§Ø±Ø³Ø§Ù„</div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Ù¾ÛŒØ´Ø±ÙØª Ø§Ø±Ø³Ø§Ù„</span>
                                        <span id="progressText">0%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div class="row text-center mb-3">
                                    <div class="col">
                                        <div class="p-2 bg-light rounded">
                                            <div class="fw-bold" id="sentCount">0</div>
                                            <small>Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</small>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="p-2 bg-light rounded">
                                            <div class="fw-bold text-success" id="successCount">0</div>
                                            <small>Ù…ÙˆÙÙ‚</small>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="p-2 bg-light rounded">
                                            <div class="fw-bold text-danger" id="errorCount">0</div>
                                            <small>Ø®Ø·Ø§</small>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="p-2 bg-light rounded">
                                            <div class="fw-bold" id="remainingCount">0</div>
                                            <small>Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <button class="btn btn-danger w-100" onclick="stopSending()" id="stopBtn" disabled>
                                    <i class="fas fa-stop me-2"></i>ØªÙˆÙ‚Ù Ø§Ø±Ø³Ø§Ù„
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-terminal me-2"></i>Ù„Ø§Ú¯ Ø§Ø±Ø³Ø§Ù„ Ø²Ù†Ø¯Ù‡</span>
                                <button class="btn btn-sm btn-outline-secondary" onclick="clearLog()">
                                    <i class="fas fa-trash me-1"></i>Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div class="log-container" id="logContainer">
                                    <div class="log-entry log-info">Ø³ÛŒØ³ØªÙ… Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØªØ¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
            <div class="tab-pane fade" id="settings">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</div>
                            <div class="card-body">
                                <form id="settingsForm">
                                    <div class="mb-3">
                                        <label for="defaultMessage" class="form-label">Ù¾ÛŒØ§Ù… Ù¾ÛŒØ´â€ŒÙØ±Ø¶</label>
                                        <textarea class="form-control" id="defaultMessage" rows="4">
Ø³Ù„Ø§Ù… [Ù†Ø§Ù…] Ø¹Ø²ÛŒØ²ØŒ
Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø§Ø² Ø·Ø±Ù [Ø³Ø§Ø²Ù…Ø§Ù†] Ø§Ø³Øª.
Ø¨Ø§ ØªØ´Ú©Ø±
                                        </textarea>
                                        <div class="form-text">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² [Ù†Ø§Ù…] Ùˆ [Ø³Ø§Ø²Ù…Ø§Ù†] Ø¯Ø± Ù…ØªÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="defaultMinDelay" class="form-label">Ø­Ø¯Ø§Ù‚Ù„ ØªØ§Ø®ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø«Ø§Ù†ÛŒÙ‡)</label>
                                        <input type="number" class="form-control" id="defaultMinDelay" 
                                               min="1" max="10" step="0.5" value="2.0">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="defaultMaxDelay" class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ§Ø®ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø«Ø§Ù†ÛŒÙ‡)</label>
                                        <input type="number" class="form-control" id="defaultMaxDelay" 
                                               min="2" max="15" step="0.5" value="5.0">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="maxPerHour" class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ù¾ÛŒØ§Ù… Ø¯Ø± Ø³Ø§Ø¹Øª</label>
                                        <input type="number" class="form-control" id="maxPerHour" 
                                               min="10" max="500" value="100">
                                    </div>
                                    
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-primary" onclick="saveSettings()">
                                            <i class="fas fa-save me-2"></i>Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="loadSettings()">
                                            <i class="fas fa-sync-alt me-2"></i>Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ±</label>
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i>
                                        Ø³Ø±ÙˆØ± ÙØ¹Ø§Ù„ Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ù‡ Ú©Ø§Ø±
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">ÙˆØ¶Ø¹ÛŒØª Ù¾ÙˆØ±Øª</label>
                                    <div class="alert alert-info">
                                        <i class="fas fa-plug me-2"></i>
                                        Ù¾ÙˆØ±Øª 5000 Ø¯Ø± Ø­Ø§Ù„ Ø´Ù†ÙˆØ¯
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">ÙØ¶Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ</label>
                                    <div class="progress mb-2">
                                        <div class="progress-bar" style="width: 25%"></div>
                                    </div>
                                    <div class="text-center small text-muted">25% Ø§Ø² 100MB Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡</div>
                                </div>
                                
                                <div class="mb-3">
                                    <button class="btn btn-outline-danger w-100" onclick="clearAllData()">
                                        <i class="fas fa-trash-alt me-2"></i>Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                                    </button>
                                    <div class="form-text text-danger">Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØªØ¨ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ -->
            <div class="tab-pane fade" id="reports">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„</span>
                        <div class="d-flex gap-2">
                            <input type="date" class="form-control form-control-sm" id="startDate">
                            <input type="date" class="form-control form-control-sm" id="endDate">
                            <button class="btn btn-sm btn-primary" onclick="filterReports()">
                                <i class="fas fa-filter me-1"></i>ÙÛŒÙ„ØªØ±
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ØªØ§Ø±ÛŒØ®</th>
                                        <th>Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</th>
                                        <th>Ù…ÙˆÙÙ‚</th>
                                        <th>Ø®Ø·Ø§</th>
                                        <th>Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</th>
                                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsTable">
                                    <tr>
                                        <td colspan="6" class="text-center">Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÙÙˆØªØ± -->
    <footer class="bg-dark text-white mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Ø±Ø¨Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§ÛŒØªØ§</h5>
                    <p class="text-muted">Ù†Ø³Ø®Ù‡ ØªØ­Øª ÙˆØ¨ - ØªÙˆØ³Ø¹Ù‡ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¢Ø³Ø§Ù†</p>
                </div>
                <div class="col-md-4">
                    <h5>Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-light" onclick="showTab('dashboard')"><i class="fas fa-arrow-left me-1"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a></li>
                        <li><a href="#" class="text-light" onclick="showTab('settings')"><i class="fas fa-arrow-left me-1"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ</h5>
                    <p class="text-muted">Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„ØŒ Ø¯Ú©Ù…Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¯Ø± Ù‡Ø± Ø¨Ø®Ø´ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</p>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="d-flex justify-content-between align-items-center">
                <div>Â© Û±Û´Û°Û³ - ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª | Ù†Ø³Ø®Ù‡ Û±.Û°.Û°</div>
                <div>
                    <a href="#" class="text-light me-3"><i class="fab fa-github fa-lg"></i></a>
                    <a href="#" class="text-light"><i class="fab fa-telegram fa-lg"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        let currentBotId = null;
        let progressInterval = null;
        
        // ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ
        function showTab(tabId) {
            const tabTrigger = document.querySelector(`[data-bs-target="#${tabId}"]`);
            if (tabTrigger) {
                bootstrap.Tab.getOrCreateInstance(tabTrigger).show();
            }
        }
        
        function showNotification(message, type = 'info') {
            const alertTypes = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            };
            
            const alertClass = alertTypes[type] || 'alert-info';
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        
        function addToLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('logContainer').innerHTML = 
                '<div class="log-entry log-info">Ù„Ø§Ú¯ Ù¾Ø§Ú© Ø´Ø¯</div>';
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ø±Ø¨Ø§Øª
        async function startLogin() {
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            if (!phoneNumber.match(/^09\d{9}$/)) {
                showNotification('Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø¨Ø§ÛŒØ¯ Ø¨Ø§ 09 Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯ Ùˆ 11 Ø±Ù‚Ù…ÛŒ Ø¨Ø§Ø´Ø¯', 'error');
                return;
            }

            document.getElementById('loginBtn').disabled = true;
            addToLog('Ø¯Ø± Ø­Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ Ø±Ø¨Ø§Øª...', 'info');

            try {
                // Ù‡Ù…ÛŒØ´Ù‡ ÛŒÚ© Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¨Ø§Ø± Ù„Ø§Ú¯ÛŒÙ† Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                await createBot();
                if (!currentBotId) return; // Ø§Ú¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¨Ø§Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯

                addToLog(`Ø§Ø±Ø³Ø§Ù„ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† ${phoneNumber} Ø¨Ù‡ Ø³Ø±ÙˆØ±...`, 'info');
                const response = await fetch(`${API_BASE_URL}/bot/${currentBotId}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone_number: phoneNumber })
                });

                const data = await response.json();
                if (data.status === 'waiting_for_code') {
                    showNotification('Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'info');
                    document.getElementById('codeEntrySection').style.display = 'block';
                    document.getElementById('loginStatus').innerHTML =
                        '<div class="alert alert-info mt-3">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ÙˆØ±ÙˆØ¯ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯...</div>';
                    addToLog('Ù…Ù†ØªØ¸Ø± ÙˆØ±ÙˆØ¯ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±.', 'info');
                } else if (data.status === 'success') {
                    showNotification('Ø´Ù…Ø§ Ø§Ø² Ù‚Ø¨Ù„ Ù„Ø§Ú¯ÛŒÙ† Ù‡Ø³ØªÛŒØ¯.', 'success');
                    document.getElementById('loginBtn').disabled = true;
                    addToLog('Ù†Ø´Ø³Øª Ù‚Ø¨Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. Ù„Ø§Ú¯ÛŒÙ† Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.', 'success');
                } else {
                    showNotification(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ù„Ø§Ú¯ÛŒÙ†', 'error');
                    document.getElementById('loginBtn').disabled = false;
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                document.getElementById('loginBtn').disabled = false;
                console.error(error);
            }
        }

        async function submitCode() {
            const code = document.getElementById('verificationCode').value.trim();
            if (!code) {
                showNotification('Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            if (!currentBotId) {
                showNotification('Ù‡ÛŒÚ† Ø±Ø¨Ø§Øª ÙØ¹Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ Ú©Ø¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                return;
            }

            document.getElementById('submitCodeBtn').disabled = true;
            addToLog('Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ù‡ Ø³Ø±ÙˆØ±...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/bot/${currentBotId}/submit-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });

                const data = await response.json();
                if (data.status === 'success') {
                    showNotification('Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!', 'success');
                    document.getElementById('loginStatus').innerHTML =
                        '<div class="alert alert-success mt-3">âœ… Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.</div>';
                    document.getElementById('codeEntrySection').style.display = 'none';
                    document.getElementById('sendBtn').disabled = false; // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„
                    addToLog('Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØ§ÛŒÛŒØ¯ Ø´Ø¯.', 'success');
                } else {
                    showNotification(data.error || 'Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'error');
                    document.getElementById('submitCodeBtn').disabled = false;
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                document.getElementById('submitCodeBtn').disabled = false;
                console.error(error);
            }
        }
        
        async function createBot() {
            try {
                const response = await fetch(`${API_BASE_URL}/bot/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        bot_id: `bot_${Date.now()}`,
                        headless: false, // Always show browser for login
                        min_delay: parseFloat(document.getElementById('minDelay').value),
                        max_delay: parseFloat(document.getElementById('maxDelay').value)
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentBotId = data.bot_id;
                    showNotification('Ø±Ø¨Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯', 'success');
                    return true;
                } else {
                    showNotification(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¨Ø§Øª', 'error');
                    return false;
                }
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                console.error(error);
                return false;
            }
        }
        
        function updateSendType() {
            const sendType = document.getElementById('sendType').value;
            const excelSection = document.getElementById('excelSection');
            const groupSection = document.getElementById('groupSection');
            
            if (sendType === 'excel') {
                excelSection.style.display = 'block';
                groupSection.style.display = 'none';
            } else {
                excelSection.style.display = 'none';
                groupSection.style.display = 'block';
            }
        }
        
        // Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„
        document.getElementById('excelFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('excelFileName').textContent = 
                    `ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                addToLog(`ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯: ${file.name}`, 'info');
            }
        });
        
        // Ø³Ø§ÛŒØ± ØªÙˆØ§Ø¨Ø¹
        function refreshStats() {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¢Ù…Ø§Ø±
            const total = Math.floor(Math.random() * 1000) + 500;
            const success = Math.floor(total * 0.95);
            const error = total - success;
            
            document.getElementById('totalMessages').textContent = total.toLocaleString();
            document.getElementById('successMessages').textContent = success.toLocaleString();
            document.getElementById('errorMessages').textContent = error.toLocaleString();
            
            showNotification('Ø¢Ù…Ø§Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
        }
        
        function clearAllData() {
            if (confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ\nØ§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª!')) {
                showNotification('ØªÙ…Ø§Ù…ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'info');
                addToLog('ØªÙ…Ø§Ù…ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'warning');
            }
        }
        
        async function checkSessionStatus() {
            const statusDiv = document.getElementById('sessionStatus');
            statusDiv.innerHTML = `
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</span>
                </div>
                <p class="mt-2">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù†Ø´Ø³Øª...</p>`;

            try {
                // Only create a new bot if one doesn't exist
                if (!currentBotId) {
                    await createBot();
                    if (!currentBotId) {
                        throw new Error("Failed to create a bot for session check.");
                    }
                }

                const response = await fetch(`${API_BASE_URL}/bot/${currentBotId}/status`);
                const data = await response.json();

                if (data.is_logged_in) {
                    statusDiv.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù„Ø§Ú¯ÛŒÙ† Ù‡Ø³ØªÛŒØ¯.
                        </div>`;
                } else {
                    statusDiv.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Ø´Ù…Ø§ Ù„Ø§Ú¯ÛŒÙ† Ù†ÛŒØ³ØªÛŒØ¯. Ù„Ø·ÙØ§Ù‹ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.
                        </div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-times-circle me-2"></i>
                        Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù†Ø´Ø³Øª.
                    </div>`;
                console.error(error);
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', function() {
            checkSessionStatus();

            document.querySelector('a[data-bs-toggle="tab"][href="#login"]').addEventListener('shown.bs.tab', function () {
                checkSessionStatus();
            });

            // ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
            fetch(`${API_BASE_URL}/settings`)
                .then(response => {
                    if (response.ok) {
                        document.getElementById('botStatus').textContent = 'Ù…ØªØµÙ„ Ø¨Ù‡ Ø³Ø±ÙˆØ±';
                    }
                })
                .catch(() => {
                    showNotification('Ø³Ø±ÙˆØ± Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø³Ø±ÙˆØ± Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª.', 'error');
                });
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
            loadSettings();
            
            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
            setInterval(refreshStats, 30000);
        });
        
        async function startSending() {
            if (!currentBotId) {
                showNotification('Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ø§Ø² ØªØ¨ "ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§ÛŒØªØ§" Ù„Ø§Ú¯ÛŒÙ† Ú©Ù†ÛŒØ¯.', 'error');
                return;
            }

            const message = document.getElementById('messageToSend').value.trim();
            if (!message) {
                showNotification('Ù…ØªÙ† Ù¾ÛŒØ§Ù… Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯.', 'error');
                return;
            }

            const sendType = document.getElementById('sendType').value;
            let payload = {
                type: sendType,
                message: message
            };

            document.getElementById('sendBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            addToLog('Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„...', 'info');

            try {
                if (sendType === 'excel') {
                    const excelFile = document.getElementById('excelFile').files[0];
                    if (!excelFile) {
                        showNotification('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'error');
                        document.getElementById('sendBtn').disabled = false;
                        return;
                    }

                    const formData = new FormData();
                    formData.append('file', excelFile);
                    const uploadResponse = await fetch(`${API_BASE_URL}/contacts/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    const uploadResult = await uploadResponse.json();

                    if (!uploadResponse.ok) {
                        throw new Error(uploadResult.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„');
                    }
                    payload.excel_path = uploadResult.filepath;
                    addToLog(`ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ù…Ø³ÛŒØ± ${uploadResult.filepath} Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯.`, 'info');

                } else if (sendType === 'group_message') {
                    payload.group_name = document.getElementById('groupName').value.trim();
                    payload.message_prefix = document.getElementById('messagePrefix').value.trim();
                    if (!payload.group_name || !payload.message_prefix) {
                        showNotification('Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ Ùˆ Ù¾ÛŒØ´ÙˆÙ†Ø¯ Ù¾ÛŒØ§Ù… Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.', 'error');
                        document.getElementById('sendBtn').disabled = false;
                        return;
                    }
                }

                const sendResponse = await fetch(`${API_BASE_URL}/bot/${currentBotId}/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const sendResult = await sendResponse.json();
                if (sendResponse.ok) {
                    showNotification(`Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ${sendResult.total} Ú©Ø§Ø±Ø¨Ø± Ø´Ø±ÙˆØ¹ Ø´Ø¯.`, 'success');
                    progressInterval = setInterval(updateSendProgress, 3000);
                } else {
                    throw new Error(sendResult.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ø±Ø³Ø§Ù„');
                }

            } catch (error) {
                showNotification(error.message, 'error');
                addToLog(`Ø®Ø·Ø§: ${error.message}`, 'error');
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            }
        }
        
        let lastLogCount = 0;
        async function updateSendProgress() {
            if (!currentBotId) return;

            try {
                const response = await fetch(`${API_BASE_URL}/bot/${currentBotId}/send/status`);
                const stats = await response.json();

                if (response.ok) {
                    const percent = stats.total > 0 ? (stats.sent / stats.total) * 100 : 0;
                    document.getElementById('progressBar').style.width = `${percent}%`;
                    document.getElementById('progressText').textContent = `${Math.round(percent)}%`;
                    document.getElementById('sentCount').textContent = stats.sent;
                    document.getElementById('successCount').textContent = stats.success;
                    document.getElementById('errorCount').textContent = stats.error;
                    document.getElementById('remainingCount').textContent = stats.total - stats.sent;

                    if (stats.logs && stats.logs.length > lastLogCount) {
                        const newLogs = stats.logs.slice(lastLogCount);
                        newLogs.forEach(log => addToLog(log, 'info'));
                        lastLogCount = stats.logs.length;
                    }

                    if (!stats.is_running) {
                        clearInterval(progressInterval);
                        progressInterval = null;
                        document.getElementById('sendBtn').disabled = false;
                        document.getElementById('stopBtn').disabled = true;
                    }
                } else {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
            } catch (error) {
                clearInterval(progressInterval);
                progressInterval = null;
                console.error('Error fetching send status:', error);
            }
        }

        async function stopSending() {
            if (!currentBotId) return;

            try {
                await fetch(`${API_BASE_URL}/bot/${currentBotId}/send/stop`, { method: 'POST' });
                if (progressInterval) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                showNotification('Ø§Ø±Ø³Ø§Ù„ Ù…ØªÙˆÙ‚Ù Ø´Ø¯', 'warning');
                addToLog('Ø§Ø±Ø³Ø§Ù„ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± Ù…ØªÙˆÙ‚Ù Ø´Ø¯', 'warning');
            } catch (error) {
                showNotification('Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ‚Ù Ø§Ø±Ø³Ø§Ù„', 'error');
            }
        }
        
        function loadSettings() {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            showNotification('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'info');
        }
        
        function saveSettings() {
            showNotification('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
        }
        
        function filterReports() {
            showNotification('Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ ÙÛŒÙ„ØªØ± Ø´Ø¯Ù†Ø¯', 'info');
        }
    </script>
</body>
</html>